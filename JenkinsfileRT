@Library('utils@refactor') _

// [skip ci] and [ci skip] have no effect here.
if (utils.scm_checkout(['skip_disable':true])) return

// Allow modification of the job configuration, affects all relevant build configs.
// Pass this object in the argument list to the`run()` function below to apply these settings to the job's execution.
jobconfig = new JobConfig()
jobconfig.post_test_summary = true

// Pytest wrapper
def PYTEST_BASETEMP = "test_outputs"
def PYTEST = "pytest \
              -r s \
              --basetemp=${PYTEST_BASETEMP} \
              --junit-xml=results.xml"

bc = new BuildConfig()
bc.nodetype = 'RHEL-6'
bc.name = '3.6'
bc.conda_packages = ['python=3.6',
                     'pytest=3.8.2',
]

bc.test_cmds = ["printenv | sort",
                "${PYTEST}"
]

utils.run([bc, jobconfig])
